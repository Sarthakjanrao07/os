#include <pthread.h>
#include <semaphore.h>
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

sem_t writeLock;
sem_t readLock;
int readCount = 0;

void *reader(void *arg) {
    sem_wait(&readLock);
    readCount++;
    if (readCount == 1) {
        sem_wait(&writeLock);
    }
    sem_post(&readLock);

    printf("Reader %ld is reading\n");

    sem_wait(&readLock);
    readCount--;
    if (readCount == 0) {
        sem_post(&writeLock);
    }
    sem_post(&readLock);

    return NULL;
}

void *writer(void *arg) {
    sem_wait(&writeLock);

    printf("Writer %ld is writing\n");

    sem_post(&writeLock);

    return NULL;
}

int main() {
    pthread_t readers[3], writers[3];

    sem_init(&readLock, 0, 1);
    sem_init(&writeLock, 0, 1);

    for (int i = 0; i < 3; i++) {
        pthread_create(&readers[i], NULL, reader, NULL);
        pthread_create(&writers[i], NULL, writer, NULL);
    }

    for (int i = 0; i < 3; i++) {
        pthread_join(readers[i], NULL);
        pthread_join(writers[i], NULL);
    }

    sem_destroy(&readLock);
    sem_destroy(&writeLock);

    return 0;
}

#!/bin/bash
fname='Adbook.txt'
touch $fname
cat $fname
a=1
while [ $a -eq 1 ]
do
    echo -e "Enter a choice -\n1) Insert\n2) Display\n3) Delete\n4) Modify"
    read ch
    case $ch in
        1)
            echo -e "\nEnter your name"
            read name
            echo -e "\nEnter phone number"
            read phone
            echo -e "\nEnter city"
            read city
            echo -e "\nEnter pin number"
            read pin
            echo -e "\nEnter state"
            read state
            echo -e "$name\t$phone\t$city\t$pin\t$state" >> $fname
            ;;
        2)
            if [ -s $fname ]
            then
                echo -e "Name\tPhone number\tCity\tPin\tState\n"
                cat $fname
            else
                echo -e "\nFile is empty"
            fi
            ;;
        3)
            echo -e "\nEnter name to delete record for"
            read name1
            grep -v $name1 $fname > temp
            if [ $? -eq 0 ]
            then
                echo -e "\nRecord deleted"
                mv temp $fname
            else
                echo -e "\nRecord not found"
            fi
            ;;
        4)
            echo -e "\nEnter record to modify"
            read name2
            no=$(grep -n "$name2" $fname | cut -c 1)
            if [ -z "$no" ]
            then
                echo -e "\nRecord not found"
            else
                echo -e "\nModifying line number :: $no"
                echo -e "\nEnter new record (format: Name\tPhone\tCity\tPin\tState)"
                read name3
                sed -i "$no s/.*/$name3/" $fname
                echo -e "\nRecord modified"
            fi
            ;;
    esac
done
